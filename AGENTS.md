# Operational Agent Charter

> This charter is regenerated by `scripts/manage-agents.mjs`. Run `npm run agent:sync` at the beginning and end of every session so the manifest stays authoritative.

## Execution Contract
- The repository is an Expo 53 / React Native 0.79 app that powers an advanced network diagnostics and security research assistant. Every contribution must be production-ready and align with security research ethics.
- No placeholders, stubs, mocks, simplified snippets, or partially implemented logic are ever permitted. Ship complete, fully working features with exhaustive error handling.
- Always understand the impacted modules before editing: inspect existing implementations, analytics hooks, and persistence flows so that updates remain consistent with the holistic architecture.

## Required Workflow
1. Install dependencies with `npm install` (or `bun install` if you intentionally opt into Bun).
2. Synchronize agent files via `npm run agent:sync`. Commit both source and regenerated AGENTS documents together.
3. Implement changes using strongly typed TypeScript, platform-specific React Native patterns, and repository utilities (zustand stores, NativeWind, analytics tracking, etc.).
4. Format code with `npx prettier --write .` and lint via `npm run lint`; fix every warning.
5. Run `npm run typecheck`, `npm test`, and any relevant Detox end-to-end flows (`npm run detox:build:*` then `npm run test:e2e:*`) when changes touch runtime behaviour. Capture and document failures instead of ignoring them.
6. Update documentation (including this charter or nested AGENTS files) whenever behaviour, APIs, or architecture shift.

## Architecture Overview
- **State Management:** Zustand stores in `src/state` coordinate onboarding, Tetris gameplay loops, rewards, feature flags, and persistent analytics toggles. Stores use AsyncStorage-backed persistence and emit retention events—extend them with immutable updates and mirrored unit tests in `__tests__`.
- **Design System:** Shared primitives live in `src/design-system` with tokens, animation helpers, and component wrappers built around NativeWind and Tailwind tokens. New UI must consume tokens and respect the theming contract exposed through `tokens.ts`.
- **Navigation:** Multi-stack navigation is implemented under `src/navigation` using React Navigation 7. Follow established navigator patterns, extend typed param lists, and update linking configs when screens move.
- **Services & Monitoring:** Network diagnostics, analytics, and notification orchestration live in `src/services`, `src/analytics`, and `src/monitoring`. Use platform-appropriate public APIs (CoreWLAN/NetworkExtension on iOS, WifiManager/VpnService on Android) with graceful degradation when unavailable.
- **Utilities:** Centralised helpers (logging, retry semantics, ASCII rendering, SFX) exist in `src/utils`. Reuse them rather than reimplementing behaviour.

## Implementation Directives
- Prefer functional, composable React components with hooks split into dedicated modules (see `src/utils/useApiRequest.ts`). Memoize heavy computations and respect React Native performance constraints.
- Capture analytics through `src/analytics/analyticsClient.ts` and log operational data using `src/utils/logger.ts`. Every network diagnostic feature should emit structured retention events.
- When adding native functionality, wire TurboModules / Native Modules via `src/services/network/nativeModule.ts`, providing fallbacks and TypeScript-safe facades. Include integration notes for Xcode (entitlements, NetworkExtension permissions) and Android manifests where applicable.
- Persisted data must remain backward compatible. Migrate Zustand schemas carefully and provide default migrations inside store initialisation.

## Documentation & Knowledge Management
- Keep `docs/` synchronized with feature work (design decisions, market analysis, onboarding research). Record new instrumentation or UX changes in the appropriate document and link from PR descriptions when relevant.
- When introducing new sub-domains, add dedicated AGENTS guides by updating `scripts/manage-agents.mjs` so future contributors inherit precise context.

## Agent Governance
- This repository treats AGENTS files as canonical contributor guidance. The manifest in `scripts/manage-agents.mjs` defines every sanctioned AGENTS file. Running `npm run agent:sync` will create, update, or delete AGENTS files to match the manifest—never edit generated files without updating the manifest.
- If you create a new directory that requires bespoke guidance, extend the manifest with a new entry, document its scope, and re-run the sync command.
- Do not leave obsolete AGENTS files in the tree—the sync command will remove anything not declared in the manifest.

Stay rigorous, document intent, and ensure every change elevates the production readiness of this network diagnostics platform.
