# Operational Agent Charter

> This charter is regenerated by `scripts/manage-agents.mjs`. Run `npm run agent:sync` at the beginning and end of every session so the manifest stays authoritative.

## Execution Contract
- The repository is an Expo 53 / React Native 0.79 app that powers the React T3TR15 arcade experience. Every contribution must enhance the fast-paced Tetris gameplay loop while keeping the build production-ready.
- No placeholders, stubs, mocks, or half-implemented features are ever permitted. Ship complete, functional code with thoughtful error handling and polish.
- Always understand the impacted modules before editing: inspect gameplay state, reward logic, onboarding flows, and navigation scaffolding so updates remain cohesive.

## Required Workflow
1. Install dependencies with `npm install` (or `bun install` if you intentionally opt into Bun).
2. Synchronize agent files via `npm run agent:sync`. Commit both source and regenerated AGENTS documents together.
3. Implement changes using strongly typed TypeScript, platform-aware React Native patterns, and the shared utilities already in the project (Zustand stores, design system tokens, SFX helpers, etc.).
4. Format code with `npx prettier --write .` and lint via `npm run lint`; fix every warning.
5. Run `npm run typecheck` and `npm test` for every substantive change. Execute Detox flows when altering navigation or onboarding (build then run the matching `npm run detox:*` commands). Document any failures.
6. Update documentation (including this charter or nested AGENTS files) whenever behaviour, UX copy, or architecture shifts.

## Architecture Overview
- **State Management:** Zustand stores in `src/state` coordinate onboarding, Tetris gameplay loops, rewards, and notification preferences. Stores use AsyncStorage-backed persistence—extend them with immutable updates and mirrored unit tests in `__tests__`.
- **Main Loop:** `src/mainLoop/useMainLoop.ts` hooks into the React Native AppState to begin and end play sessions automatically. Any gameplay change that affects cadence must stay compatible with this hook.
- **Design System:** Shared primitives live in `src/design-system` with tokens, animation helpers, and component wrappers built around NativeWind/Tailwind. New UI must consume these tokens and respect theming.
- **Navigation:** Multi-stack navigation is implemented under `src/navigation` using React Navigation 7. Follow established navigator patterns, extend typed param lists, and keep linking/deep-link definitions synchronized.
- **Gameplay Rendering:** `src/screens/TetrisScreen.tsx` centralises gesture handling, haptics, and FX; coordinate with `src/components/MatrixRain.tsx` and `src/components/SlashTrail.tsx` when altering visuals.
- **Utilities:** Centralised helpers (logging, retry semantics, ASCII rendering, SFX) exist in `src/utils`. Reuse them rather than reimplementing behaviour.

## Implementation Directives
- Prefer functional, composable React components with hooks split into dedicated modules (see `src/mainLoop/useMainLoop.ts`). Memoize heavy computations and respect React Native performance constraints.
- Keep gameplay responsive: avoid blocking renders, batch store updates, and ensure animations run at 60 fps on mid-tier hardware.
- Persisted data must remain backward compatible. Migrate Zustand schemas carefully and provide default migrations inside store initialisation when shapes change.

## Documentation & Knowledge Management
- Keep `docs/` synchronized with the shipped Tetris experience (game design notes, scoring tables, UX rationale). Update `docs/roadmap.md` whenever priorities shift so planning reflects the live backlog.
- When introducing new subsystems, extend the AGENTS manifest so future contributors inherit the right context.

## Agent Governance
- This repository treats AGENTS files as canonical contributor guidance. The manifest in `scripts/manage-agents.mjs` defines every sanctioned AGENTS file. Running `npm run agent:sync` will create, update, or delete AGENTS files to match the manifest—never edit generated files without updating the manifest.
- If you create a new directory that requires bespoke guidance, extend the manifest with a new entry, document its scope, and re-run the sync command.
- Do not leave obsolete AGENTS files in the tree—the sync command will remove anything not declared in the manifest.

Stay rigorous, document intent, and ensure every change keeps React T3TR15 feeling like the definitive retro Tetris homage.
